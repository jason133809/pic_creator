# 图片字幕生成器 PRD

## 产品愿景
- 以极低操作成本，让任何人都能在图片上快速生成高可读字幕并一键导出
- 坚持纯前端本地处理，保护隐私，零学习门槛，适配常见工作与创作场景

## 背景与问题陈述
- 图片表达信息有限，会议截图/课堂照片/社媒素材需要补充文字说明
- 现有做法多依赖专业工具或复杂操作，效率低且风格不统一
- 用户需要一个“开箱即用、稳定可读、导出一致”的轻量工具

## 目标与成功指标
- 使用目标：首次进入到成功导出 ≤ 60 秒；关键参数调整不超过 5 次
- 质量目标：1080p 图片合成时间 ≤ 300 ms；导出与预览一致性 ≥ 99%
- 可用性目标：新手完成任务成功率 ≥ 95%；错误提示理解度 ≥ 90%
- 留存目标：次周回访率 ≥ 30%（办公与创作人群）
- 满意度：字幕可读性满意度 ≥ 4.5/5；隐私与本地处理信任度 ≥ 4.7/5

## 核心用户画像
- 办公/运营人员：为会议截图加关键信息后分发
- 教学/培训人员：为课堂或讲义图片补充要点
- 社媒创作者：为照片添加叙述，提高点击与传播
- 隐私敏感用户：希望本地处理，避免云端上传

## 使用场景
- 会后复盘：会议截图加结论/行动项
- 资料归档：图片化文档附注释，保证长期可读
- 内容发布：社媒配图带字幕，提高信息密度
- 内部汇报：项目图片说明，统一视觉风格

## 竞品与差异化
- 图片编辑器类（PS/美图/Canva）：功能强但学习成本高、流程复杂
- 在线加字工具：流程简化但多为云端处理、导出风格不统一
- 差异化：纯前端本地、极简参数、默认“高可读字幕”最佳实践、导出与预览一致

## 范围与优先级
### Must-have
- 上传单张图片（JPG/PNG/WebP，最大边 ≤ 4096）
- 字幕区域高度可调，固定底部，半透明黑底
- 文本样式：字号/颜色/描边色/字体/字重
- 自动换行与居中排版，实时预览
- 生成与下载（PNG），成功/错误提示
### Should-have
- 透明度滑块（0–0.8）
- 分条追加模式：当输入多行字幕时，将原图底部“字幕高度”的切片按行数追加到原图下方，每条上叠加一行文字与分隔线
- 分条间距控制：0–12 px（默认 2，建议 0–2 以几乎不可见）
- 分隔线样式控制：粗细 0–3 px（0 代表无分隔线）、颜色可选（默认白色）
- 主题预设（黑底白字 / 白底黑字）
 - 可选右上角水印：文本、字号（10–32）、透明度（0.1–0.6）
### Could-have
- 位置选择（顶部/底部/居中）
- 下载格式切换（PNG/JPG）
- 快捷键（S 保存，Esc 清空）

## 用户旅程
- 进入页面 → 上传图片 → 默认字幕样式即时预览
- 调整“高度/字号/颜色/描边/字重/字体/透明度” → 预览实时更新
- 输入多行文案 → 点击“生成字幕图片” → 成功提示 → “保存图片”下载
- 异常：未上传图片时禁用生成/保存；不支持格式/过大图片明确提示

## 信息架构与界面结构
- 左侧：上传区域 + 参数面板（高度、字号、透明度、颜色、描边、字体、字重）
- 下方：文案输入框（多行、500 字上限）
- 右侧：预览画布（等比展示，滚动适配）
- 底部：主要按钮（生成字幕图片、保存图片），状态提示条

## 功能规格与规则
### 上传
- 支持拖拽/点击选择；超限或不支持格式给出错误
- 使用 URL.createObjectURL 显示预览；不进行网络传输
### 合成
- Canvas 尺寸与原图一致，超 4096 等比缩放至 4096
- 单行模式（整块遮罩）：drawImage → 绘制底部整块半透明遮罩 → 自动断行排版 → fillText + strokeText
- 多行模式（分条追加）：drawImage → 离屏画布复制原图底部“字幕高度”切片 → 扩展画布高度并按行数追加切片 → 每条加上下白色分隔线与文字居中 → 导出
- 数值健壮性：字号/字幕高度/透明度/间距的解析具备容错（空值/非法值回退默认）
### 文本排版
- 中文按字符、英文按词组基于 measureText 断行
- 行距 1.4；居中对齐；边距 24 px；不溢出字幕区域
### 样式默认值
- 高度 80 px；字号 40 px；字色 #FFFFFF；描边 #000000；透明度 0.5（分条推荐 0–0.3）
- 字体栈：Microsoft YaHei, PingFang SC, Noto Sans SC, Arial
- 字重：正常；描边宽度 1–2 px（分辨率自适应）
- 分条默认：间距 2 px；分隔线 1 px 白色；水印关闭
### 交互与文案
- 无图片：提示“请先上传图片”；禁用生成/保存
- 成功：提示条“字幕图片生成成功！”
- 错误：格式不支持/图片过大/文本超限，分别给出明确描述与处理建议
### 边界与降级
- Emoji/特殊符号可能不一致：提示“部分符号显示效果可能受系统字体影响”
- 字体回退：系统无所选字体时自动回退至字体栈下一个

## 非功能与质量要求
- 性能：2K 图片合成 ≤ 300 ms；内存占用稳定，无明显卡顿
- 一致性：预览与导出像素级一致
- 兼容性：桌面 Chrome/Edge 最新版；Safari 基本支持
- 可访问性：默认样式满足 AA 对比度；控件有键盘可操作性与清晰标签
- 隐私：本地处理，不上传任何数据；不收集使用信息（MVP）
- 体验细节：扩展画布后重置绘图状态（font/对齐/描边等）以保证分条模式字体控件有效；预览容器支持滚动查看追加区域

## 技术方案建议
- 前端：原生 HTML/CSS/JS 或轻框架（如 React），Canvas 合成
- 状态管理：轻量本地状态，无后端
- 导出：canvas.toBlob 优先，回退 toDataURL；文件命名“原图名_subtitled.png”
- 代码质量：参数校验独立模块；错误统一管理；避免引入大型库

## 数据埋点（可选）
- 事件：上传成功/失败、参数变更、生成点击、导出成功/失败
- 指标：首生成时长、生成成功率、错误分布
- 说明：MVP 不采集；若需优化体验再开启本地统计或匿名埋点

## 风险与对策
- 字体差异影响观感 → 提供字体栈与回退提示
- 超高分辨率导致卡顿 → 上限缩放与提示
- 文案极长影响可读性 → 上限与自动断行，建议拆分
- 浏览器差异 → 采用广泛支持的 Canvas API，关键路径做兼容测试

## 上线与验收
### 验收用例
- 上传 1080p 图片，默认参数生成并导出，肉眼可读、无溢出
- 调整透明度/高度/字号/颜色/字重后，预览与导出一致
- 中文/英文/混合文本自动换行，无文字出框
- 空状态/错误状态提示准确、文案清晰
### 上线清单
- 浏览器兼容性验证、性能指标达标、静态资源体积控制、无隐私风险说明

## 迭代路线图
- v0.1：MVP 核心功能（当前文档）
- v0.2：分条样式参数化（分隔线颜色/粗细、横带宽度包裹文字/铺满）、主题预设、JPG 导出
- v0.3：字幕位置选择、快捷键、移动端适配、参数模板、导出尺寸控制

## 变更记录
- v0.1.1
  - 新增“分条追加到底部”模式：多行字幕时每行生成底部切片横带并追加到原图下方
  - 新增分隔线与透明度可调范围（0–0.8）
  - 修复：扩展画布高度后字体状态被重置导致字体控件失效的问题
  - 优化：数值解析容错与预览容器滚动
- v0.1.2
  - 新增控件：分条间距（0–12，默认 2）、分隔线粗细（0–3）、分隔线颜色
  - 新增水印参数：文本、字号、透明度
  - 体验：默认间距趋近不可见，满足“分条几乎看不见”的需求
## 项目计划（建议）
- 设计与规格敲定：0.5 天（本 PRD 即设计蓝本）
- 开发与联调：1.5–2 天（含断行与描边细节）
- 测试与优化：0.5 天（性能与兼容性）
- 总计：约 3 天完成可发布版本

## 审美与使用建议
- 讲述型素材用默认主题；品牌素材可切换白底黑字以适配浅色背景
- 文案长度控制在 4–6 行之间，避免太密影响阅读节奏
- 透明度在 0.45–0.6 为最佳折中；背景复杂可升至 0.65–0.7
